create database FileCabinet;
go

use FileCabinet;

create table Faculty
(    
	FacultyCode  varchar(10) constraint FACULTY_PK primary key,
	FacultyName varchar(100) default 'None'
);

insert into Faculty   (FacultyCode,   FacultyName )
	values	('ХТиТ', 'Химическая технология и техника'),
			('ЛХФ', 'Лесохозяйственный факультет'),
			('ИЭФ', 'Инженерно-экономический факультет'),
			('ТТЛП', 'Технология и техника лесной промышленности'),
			('ТОВ', 'Технология органических веществ'),
			('ИТ', 'Факультет информационных технологий'),
			('ИДиП', 'Издательское дело и полиграфия');

create table  Pulpit 
(   
	PulpitCode  varchar(10) constraint PULPIT_PK  primary key,
    PulpitName  varchar(100) default 'None', 
    FacultyCode varchar(10) constraint FK_PULPIT_FACULTY foreign key
                         references Faculty(FacultyCode) 
);

insert into Pulpit(PulpitCode, PulpitName, FacultyCode )
	values	('ИСиТ', 'Информационных систем и технологий','ИТ'),
			('ПОиСОИ','Полиграфического оборудования и систем обработки информации', 'ИДиП'),
			('БФ', 'Белорусской филологии','ИДиП'),
			('РИТ', 'Редакционно-издательских тенологий', 'ИДиП'),            
			('ПП', 'Полиграфических производств','ИДиП'),                              
			('ЛВ', 'Лесоводства','ЛХФ'),          
			('ЛУ', 'Лесоустройства','ЛХФ'),           
			('ЛЗиДВ', 'Лесозащиты и древесиноведения','ЛХФ'),                
			('ЛКиП', 'Лесных культур и почвоведения','ЛХФ'), 
			('ТиП', 'Туризма и природопользования','ЛХФ'),              
			('ЛПиСПС','Ландшафтного проектирования и садово-паркового строительства','ЛХФ'),          
			('ТЛ', 'Транспорта леса', 'ТТЛП'),                          
			('ЛМиЛЗ','Лесных машин и технологии лесозаготовок','ТТЛП'),  
			('ТДП','Технологий деревообрабатывающих производств', 'ТТЛП'),   
			('ТиДИД','Технологии и дизайна изделий из древесины','ТТЛП'),    
			('ОХ', 'Органической химии','ТОВ'), 
			('ХПД','Химической переработки древесины','ТОВ'),             
			('ТНВиОХТ','Технологии неорганических веществ и общей химической технологии','ХТиТ'), 
			('ПиАХП','Процессов и аппаратов химических производств','ХТиТ'),                                               
			('ЭТиМ', 'Экономической теории и маркетинга','ИЭФ'),   
			('МиЭП', 'Менеджмента и экономики природопользования','ИЭФ'),
			('ИиВД', 'Информатики и веб-дизайна','ИТ'),
			('ПИ', 'Программной инженерии','ИТ'),
			('ВМ', 'Высшей математики','ИТ');

create table Specialty
(
	SpecialtyCode  varchar(10) constraint SPECIALITY_PK  primary key,
    SpecialtyName  varchar(200) default 'None', 
    PulpitCode	   varchar(10) constraint FK_SPECIALITY_PULPIT foreign key
                         references Pulpit(PulpitCode) 
);

insert into Specialty(SpecialtyCode, SpecialtyName, PulpitCode )
	values	('ИСиТ', 'Информационные системы и технологии','ИСиТ'),
			('ПОИБМС', 'Программное обеспечение информационной безопасности мобильных систем','ИСиТ'),
			('ПОИТ', 'Программное обеспечение информационных технологий','ПИ'),
			('ДЭиВИ', 'Дизайн электронных и веб-изданий','ИиВД'),
			('ИД', 'Издательское дело', 'ПП' ),
			('ПОиСОИ',  'Полиграфическое оборудование и системы обработки информации', 'ПП' ),
			('КиПИКМ',    'Конструирование и производство изделий из композиционных материалов', 'РИТ' ),             
			('МиФХПиПСМ',  'Машины и аппараты химических производств и предприятий строительных материалов', 'РИТ' ),
			('ЛХ',      'Лесное хозяйство', 'ЛВ' ),
			('СПС',   'Садово-парковое строительство', 'ЛУ' ),
			('ТиП',     'Туризм и природопользование', 'ТиП' ),
			('ЭиУП',  'Экономика и управление на предприятии', 'ЭТиМ' ),
			('БУАиА',    'Бухгалтерский учет, анализ и аудит', 'ЭТиМ' ),                   
			('МиОЛК',   'Машины и оборудование лесного комплекса', 'ТДП' ),
			('ЛД',      'Лесоинженерное дело', 'ТДП' ),
			('ХТОВ',  'Химическая технология органических веществ, материалов и изделий', 'ХПД' ),          
			('ХТПД',    'Химическая технология переработки древесины', 'ХПД' ),
			('ФХМиПККП',   'Физико-химические методы и приборы контроля качества продукции', 'ТНВиОХТ' );

create table Groups 
(   
	GroupId  int  identity(1,1) constraint GROUP_PK primary key,              
    FacultyCode  varchar(10) constraint  GROUP_FACULTY_FK foreign key         
                                                         references Faculty(FacultyCode), 
    SpecialtyCode varchar(10) constraint  GROUP_SPECIALITY_FK foreign key         
                                                         references Specialty(SpecialtyCode),
    GroupNumber smallint  check (GroupNumber > 0),
	Course smallint check (Course > 0)
)

insert into Groups(FacultyCode,  SpecialtyCode, Course, GroupNumber)
	values	('ИДиП','ИД', 1, 1), 
			('ИДиП','КиПИКМ', 1, 1),
			('ИДиП','ПОиСОИ', 1, 1),
			('ИДиП','МиФХПиПСМ',1 ,1),
			('ИДиП','ИД', 1,2),
			('ИДиП','КиПИКМ', 1,2),
			('ИДиП','ПОиСОИ', 1,2),
			('ИДиП','МиФХПиПСМ', 1,2),
			('ИДиП','ИД', 1,3),
			('ИДиП','КиПИКМ', 1,3),
			('ИДиП','ПОиСОИ', 1,3),
			('ХТиТ','ФХМиПККП', 3,1),                                            
			('ХТиТ','ФХМиПККП', 3,2),
			('ХТиТ','ФХМиПККП', 3,3),
			('ХТиТ','ФХМиПККП', 3,4),
			('ТОВ','ХТОВ',2,1), 
			('ТОВ','ХТПД',2,1),
			('ТОВ','ХТОВ',2,2),
			('ТОВ','ХТПД',2,2),
			('ЛХФ','ЛХ',4,1),     
			('ЛХФ','ЛХ',4,2),
			('ЛХФ','СПС',1,1),
			('ЛХФ','СПС',1,2),
			('ЛХФ','СПС',1,3),  
			('ТТЛП','ЛД', 2,1),
			('ТТЛП','ЛД', 2,2),
			('ТТЛП','ЛД', 2,3),
			('ИЭФ','ЭиУП',1,1), 
			('ИЭФ','ЭиУП',1,2),     
			('ИЭФ','ЭиУП',2,1),
			('ИЭФ','ЭиУП',2,2),
			('ИЭФ','ЭиУП',3,1),
			('ИТ','ПОИТ',1,1), 
			('ИТ','ПОИТ',1,2),     
			('ИТ','ПОИТ',2,1),
			('ИТ','ПОИТ',2,2),
			('ИТ','ПОИТ',2,3),
			('ИТ','ПОИТ',2,4),     
			('ИТ','ИСиТ',2,1),
			('ИТ','ИСиТ',2,2),
			('ИТ','ИСиТ',3,1);

create table Student 
(    
	StudentId int identity(1,1) constraint STUDENT_PK  primary key,
    GroupId int constraint STUDENT_GROUP_FK foreign key         
                    references Groups(GroupId),        
    FirstName   nvarchar(100) NOT NULL, 
	LastName   nvarchar(100) NOT NULL, 
	Patronymic   nvarchar(100) default('None'), 
    Birthday date,
	PhoneNumber nvarchar(15) default('None'),
    Foto varbinary(max)
 ) 

insert into Student (GroupId, FirstName, LastName, Patronymic, Birthday)
	values	(1, 'Хартанович','Екатерина','Александровна', '11.03.1995'),        
			(1, 'Горбач', 'Елизавета', 'Юрьевна', '07.12.1995'),
			(1, 'Зыкова', 'Кристина', 'Дмитриевна', '12.10.1995'),
			(1, 'Шенец', 'Екатерина', 'Сергеевна', '08.01.1995'),
			(1, 'Шитик', 'Алина', 'Игоревна', '02.08.1995'),     
			(2, 'Силюк', 'Валерия', 'Ивановна','12.07.1994'),
			(2, 'Сергель     ','Виолетта   ','Николаевна','06.03.1994'),
			(2, 'Добродей    ','Ольга      ','Анатольевна', '09.11.1994'),
			(2, 'Подоляк     ','Мария      ','Сергеевна',   '04.10.1994'),
			(2, 'Никитенко   ','Екатерина  ','Дмитриевна', '08.01.1994'),
			(2, 'Яцкевич     ','Галина     ','Иосифовна',   '02.08.1993'),
			(2, 'Осадчая     ','Эла        ','Васильевна',     '07.12.1993'),
			(2, 'Акулова     ','Елена      ','Геннадьевна',  '02.12.1993'),
			(4, 'Плешкун     ','Милана     ','Анатольевна', '08.03.1992'),
			(4, 'Буянова     ','Мария      ','Александровна','02.06.1992'),
			(4, 'Харченко    ','Елена      ','Геннадьевна', '11.12.1992'),
			(4, 'Крученок    ','Евгений    ','Александрович','11.05.1992'),
			(4, 'Бороховский ','Виталий    ','Петрович', '09.11.1992'),
			(4, 'Мацкевич    ','Надежда    ','Валерьевна','01.11.1992'),
			(5, 'Логинова    ','Мария      ','Вячеславовна','08.07.1995'),
			(5, 'Белько      ','Наталья    ','Николаевна',   '02.11.1995'),
			(5, 'Селило      ','Екатерина  ','Геннадьевна','07.05.1995'),
			(5, 'Дрозд       ','Анастасия  ','Андреевна',   '04.08.1995'),
			(6, 'Козловская  ','Елена      ','Евгеньевна', '08.11.1994'),
			(6, 'Потапнин    ','Кирилл     ','Олегович',    '02.03.1994'),
			(6, 'Равковская  ','Ольга      ','Николаевна', '04.06.1994'),
			(6, 'Ходоронок   ','Александра ','Вадимовна', '09.11.1994'),
			(6, 'Рамук       ','Владислав  ','Юрьевич',   '04.07.1994'),
			(7, 'Неруганенок ','Мария      ','Владимировна', '03.01.1993'),
			(7, 'Цыганок     ','Анна       ','Петровна',  '12.09.1993'),
			(7, 'Масилевич   ','Оксана     ','Игоревна', '12.06.1993'),
			(7, 'Алексиевич  ','Елизавета  ','Викторовна','09.02.1993'),
			(7, 'Ватолин     ','Максим     ','Андреевич',  '04.07.1993'),
			(8, 'Синица      ','Валерия    ','Андреевна',  '08.01.1992'),
			(8, 'Кудряшова   ','Алина      ','Николаевна','12.05.1992'),
			(8, 'Мигулина    ','Елена      ','Леонидовна', '08.11.1992'),
			(8, 'Шпиленя     ','Алексей    ','Сергеевич', '12.03.1992'),
			(9, 'Астафьев    ','Игорь      ','Александрович','10.08.1995'),
			(9, 'Гайтюкевич  ','Андрей     ','Игоревич','02.05.1995'),
			(9, 'Рученя      ','Наталья    ','Александровна', '08.01.1995'),
			(9, 'Тарасевич   ','Анастасия  ','Ивановна', '11.09.1995'),
			(10, 'Жоглин     ','Николай    ','Владимирович','08.01.1994'),
			(10, 'Санько     ','Андрей     ','Дмитриевич', '11.09.1994'),
			(10, 'Пещур      ','Анна       ','Александровна','06.04.1994'),
			(10, 'Бучалис    ','Никита     ','Леонидович', '12.08.1994'),
			(11, 'Лавренчук  ','Владислав  ','Николаевич','07.11.1993'),
			(11, 'Власик     ','Евгения    ','Викторовна', '04.06.1993'),
			(11, 'Абрамов    ','Денис      ','Дмитриевич',  '10.12.1993'),
			(11, 'Оленчик    ','Сергей     ','Николаевич', '04.07.1993'),
			(11, 'Савинко    ','Павел      ','Андреевич',   '08.01.1993'),
			(11, 'Бакун      ','Алексей    ','Викторович',  '02.09.1993'),
			(12, 'Бань       ','Сергей     ','Анатольевич', '11.12.1995'),
			(12, 'Сечейко    ','Илья       ','Александрович',  '10.06.1995'),
			(12, 'Кузмичева  ','Анна       ','Андреевна',   '09.08.1995'),
			(12, 'Бурко      ','Диана      ','Францевна',      '04.07.1995'),
			(12, 'Даниленко  ','Максим     ','Васильевич','08.03.1995'),
			(12, 'Зизюк      ','Ольга      ','Олеговна',       '12.09.1995'),
			(13, 'Шарапо     ','Мария      ','Владимировна',     '08.10.1994'),
			(13, 'Касперович ','Вадим      ','Викторович',   '10.02.1994'),
			(13, 'Чупрыгин   ','Арсений    ','Александрович','11.11.1994'),
			(13, 'Воеводская ','Ольга      ','Леонидовна',   '10.02.1994'),
			(13, 'Метушевский','Денис      ','Игоревич',    '12.01.1994'),
			(14, 'Ловецкая   ','Валерия    ','Александровна','11.09.1993'),
			(14, 'Дворак     ','Антонина   ','Николаевна',    '01.12.1993'),
			(14, 'Щука       ','Татьяна    ','Николаевна',       '09.06.1993'),
			(14, 'Коблинец   ','Александра ','Евгеньевна','05.01.1993'),
			(14, 'Фомичевская','Елена      ','Эрнестовна',  '01.07.1993'),
			(15, 'Бесараб    ','Маргарита  ','Вадимовна',   '07.04.1992'),
			(15, 'Бадуро     ','Виктория   ','Сергеевна',     '10.12.1992'),
			(15, 'Тарасенко  ','Ольга      ','Викторовна',    '05.05.1992'),
			(15, 'Афанасенко ','Ольга      ','Владимировна', '11.01.1992'),
			(15, 'Чуйкевич   ','Ирина      ','Дмитриевна',     '04.06.1992'),
			(33, 'Брель      ','Алеся      ','Алексеевна',        '08.01.1994'),
			(33, 'Кузнецова  ','Анастасия  ','Андреевна', '07.02.1994'),
			(33, 'Томина     ','Карина     ','Геннадьевна','12.06.1994'),
			(33, 'Дуброва    ','Павел      ','Игоревич',   '03.07.1994'),
			(33, 'Шпаков     ','Виктор     ','Андреевич',  '04.07.1994'),
			(33, 'Шнейдер    ','Анастасия  ','Дмитриевна',  '08.11.1993'),
			(33, 'Шыгина     ','Елена      ','Викторовна',  '02.04.1993'),
			(33, 'Клюева     ','Анна       ','Ивановна',     '03.06.1993'),
			(33, 'Доморад    ','Марина     ','Андреевна', '05.11.1993'),
			(33, 'Линчук     ','Михаил     ','Александрович',   '03.07.1993'),
			(33, 'Васильева  ','Дарья      ','Олеговна',      '08.01.1995'),
			(33, 'Щигельская ','Екатерина  ','Андреевна','06.09.1995'),
			(33, 'Сазонова   ','Екатерина  ','Дмитриевна', '08.03.1995'),
			(33, 'Бакунович  ','Алина      ','Олеговна',      '07.08.1995');
go
			-----------------------------------------------------------------

declare curs cursor global 
	for select S.StudentId from Student as S
	for update; 

open curs; 
declare @stub int,@number nvarchar(15) = '+375', @count int = 0; 
fetch curs into @stub;
while @@FETCH_STATUS = 0
begin
	while (@count < 7)
		begin
			set @number += cast(FLOOR(rand()*10) as nvarchar(1))
			set @count += 1;
		end;
	update Student set PhoneNumber = @number where current of curs;
	set @number = '+375';
	set @count = 0;
	fetch curs into @stub;
end
close curs;
deallocate curs;
go

					-----------------------------------------------------------------

create table Authorizations
(
	Login nvarchar(50),
	Password nvarchar(50),
	Role nvarchar(5) check(Role in ('admin', 'user')) default('user'),
	UserId int constraint FK_USER_STUDENT foreign key
                         references Student(StudentId),
	constraint PK_USER primary key(Login, Password)
)

insert into Authorizations(Login, Password, Role, UserId)
		values('admin', 'admin', 'admin', null),
			  ('user', 'user', 'user', 87);

create table Teacher
(   
	 TeacherCode    varchar(10)  constraint TEACHER_PK  primary key,
     TeacherName    varchar(100),
     PulpitCode			varchar(10) constraint TEACHER_PULPIT_FK foreign key 
                         references Pulpit(PulpitCode),
     Foto varbinary(max)
) 

insert into  Teacher(TeacherCode, TeacherName, PulpitCode)
	values	('СМЛВ', 'Смелов Владимир Владиславович', 'ИСиТ'),
			('АКНВЧ', 'Акунович Станислав Иванович', 'ИСиТ'),
			('КЛСНВ', 'Колесников Виталий Леонидович', 'ИСиТ'),
			('БРКВЧ', 'Бракович Андрей Игоревич', 'ИСиТ'),
			('ДТК', 'Дятко Александр Аркадьевич', 'ИСиТ'),
			('УРБ', 'Урбанович Павел Павлович', 'ИСиТ'),
			('ГРН', 'Гурин Николай Иванович', 'ИСиТ'),
			('ЖЛК', 'Жиляк Надежда Александровна',  'ИСиТ'),                     
			('МРЗ', 'Мороз Елена Станиславовна',    'ИСиТ'),
			('БРТШВЧ', 'Барташевич Святослав Александрович','ПОиСОИ'),
			('АРС', 'Арсентьев Виталий Арсентьевич', 'ПОиСОИ'),                       
			('БРНВСК', 'Барановский Станислав Иванович', 'ЭТиМ'),
			('НВРВ', 'Неверов Александр Васильевич', 'МиЭП'),
			('ДМДК', 'Демидко Марина Николаевна',   'ЛПиСПС'),
			('БРГ', 'Бурганская Татьяна Минаевна', 'ЛПиСПС'),
			('РЖК', 'Рожков Леонид Николаевич ', 'ЛВ'),                      
			('ЗВГЦВ', 'Звягинцев Вячеслав Борисович', 'ЛЗиДВ'), 
			('БЗБРДВ', 'Безбородов Владимир Степанович', 'ОХ'), 
			('НСКВЦ', 'Насковец Михаил Трофимович', 'ТЛ'),      
			('РВКЧ',   'Ровкач Андрей Иванович', 'ОХ');   
			
create table Subject
(     
	SubjectCode varchar(10)  constraint SUBJECT_PK  primary key, 
    SubjectName varchar(200) unique,
    PulpitCode      varchar(10)  constraint SUBJECT_PULPIT_FK foreign key 
                         references Pulpit(PulpitCode)   
)

insert into Subject (SubjectCode, SubjectName, PulpitCode)
	values	('СУБД', 'Системы управления базами данных', 'ИСиТ'),
			('БД', 'Базы данных','ИСиТ'),
			('ИНФ', 'Информационные технологии','ИСиТ'),
			('ОАиП', 'Основы алгоритмизации и программирования', 'ИСиТ'),
			('ПЗ', 'Представление знаний в компьютерных системах', 'ИСиТ'),
			('ПСП', 'Программирование сетевых приложений','ИСиТ'),
			('МСОИ', 'Моделирование систем обработки информации', 'ИСиТ'),
			('ПИС', 'Проектирование информационных систем', 'ИСиТ'),
			('КГ', 'Компьютерная геометрия ','ИСиТ'),
			('ПМАПЛ', 'Полиграф. машины, автоматы и поточные линии', 'ПОиСОИ'),
			('КМС', 'Компьютерные мультимедийные системы', 'ИСиТ'),
			('ОПП', 'Организация полиграф. производства', 'ПОиСОИ'),
			('ДМ', 'Дискретная математика', 'ИСиТ'),
			('МП', 'Математическое программирование','ИСиТ'),  
			('ЛЭВМ', 'Логические основы ЭВМ',  'ИСиТ'),                 
			('ООП', 'Объектно-ориентированное программирование', 'ИСиТ'),
			('ЭП', 'Экономика природопользования','МиЭП'),
			('ЭТ', 'Экономическая теория','ЭТиМ'),
			('БЛЗиПсOO','Биология лесных зверей и птиц с осн. охотов.','ОХ'),
			('ОСПиЛПХ','Основы садово-паркового и лесопаркового хозяйства',  'ЛПиСПС'),
			('ИГ', 'Инженерная геодезия ','ЛУ'),
			('ЛВ', 'Лесоводство', 'ЛЗиДВ'), 
			('ОХ', 'Органическая химия', 'ОХ'),   
			('ВТЛ', 'Водный транспорт леса','ТЛ'),
			('ТиОЛ', 'Технология и оборудование лесозаготовок', 'ЛМиЛЗ'), 
			('ТОПИ', 'Технология обогащения полезных ископаемых ','ТНВиОХТ'); 

create table TeacherSubject
(
	TeacherCode	varchar(10) Not Null foreign key references Teacher(TeacherCode),
	SubjectCode	varchar(10) Not Null foreign key references Subject(SubjectCode),
	Course int Not Null check(Course > 0)
)

insert into TeacherSubject(TeacherCode, SubjectCode, Course)
			values('ЖЛК','ИНФ',2),
				  ('СМЛВ','ПИС',2),
				  ('МРЗ','БД',2),
				  ('МРЗ','СУБД',2),
				  ('ПНВ','ООП',2),
				  ('СМЛВ','ООП',2),
				  ('ПНВ','ОАиП',1),
				  ('СМЛВ','ДМ',1),
				  ('НВРВ','ЭП',1),
				  ('НСКВЦ','ВТЛ',1),
				  ('АКНВЧ','КМС',1),
				  ('АКНВЧ','ЛЭВМ',3),
				  ('БРКВЧ','КГ',3),
				  ('ГРН','ЛЭВМ',3),
				  ('ДТК','МП',3),
				  ('ДТК','ПИС',3),
				  ('ЖЛК','СУБД',3);
go

create procedure GetSubjectsOfStudent @StudentId int
as select T.TeacherCode, T.TeacherName, S.SubjectCode, S.SubjectName, S.PulpitCode from Teacher as T
	inner join TeacherSubject as TS on T.TeacherCode = TS.TeacherCode
	inner join Subject as S on S.SubjectCode = TS.SubjectCode
	where TS.Course = (select G.Course from Groups as G 
		inner join Student as ST on G.GroupId = ST.GroupId 
		where ST.StudentId = @StudentId);
return;
go 
--drop procedure GetSubjectsOfStudent
declare @StudentId int = 87
exec GetSubjectsOfStudent @StudentId
go

create procedure GetStudentsOfGroup @GroupId int
as select * from Student as S where S.GroupId = @GroupId;
return;
go 
--drop procedure GetStudentsOfGroup;
declare @GroupId int = 1
exec GetStudentsOfGroup @GroupId
go